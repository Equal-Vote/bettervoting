---
layout: default
title: API Docs
nav_order: 7000
---

# Authentication

This API uses [JSON web tokens](https://jwt.io/) to authenticate requests. If using keycloak these tokens will be generated by the keycloak server, otherwise tokens will need to be generated using a secret key. This secrety key will need to be included in the [election object](models.html#election) property "auth_key" when creating the election.

**Python Create Token Example**

Using [PyJWT](https://pyjwt.readthedocs.io/en/stable/)

```
>>> import jwt
>>> my_secrety_key = "abcd1234"
>>> id_token = jwt.encode({"email": "bob@example.com"}, my_secrety_key, algorithm="HS256")
>>> print(id_token)
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzb21lIjoicGF5bG9hZCJ9.4twFt5NiznN84AWoo1d7KO1T_yoc0Z6XOpOVswacPZg
>>> jwt.decode(id_token, my_secrety_key, algorithms=["HS256"])
{"email": "bob@example.com"}
```

User data is stored within a request cookie "id_token" that should be included in all requests. Currently the only property used is "email".

**Python Reqest Example**

Using [Python Requests Module](https://www.w3schools.com/python/module_requests.asp)

```
import requests

url = 'https://star-vote.herokuapp.com/API/Elections'
myobj = { Election: { title: ... } }

response = requests.post(url, json = myobj, cookies = {"id_token": id_token})

```


# HTTP Methods

## Election
Election requests

### Create Election
Create a new election

| | |
| --------- | --------- |
| Method Type | POST |
| URL | /API/Elections |
| Content Type | application/json |
| Required Permission | none |

| Arguments | Type | Required? | Description |
| --------- | --------- | --------- | --------- |
| Election | string | required | JSON String containing [election object](models.html#election) |

**Example**
```
{ Election: 
    { title: ...
    }
}
```

**Example Response**
```
{ election: 
    { election_id: 'abcd',
      title: ... 
    }
}
```

### Retrieve Election
Retrieve election and user auth data(user auth data will likely move to separate request in the future)

| | |
| --------- | --------- |
| Method Type | GET |
| URL | /API/Election/:election_id |
| Content Type | application/json |
| Required Permission | none |

**Example Response**
```
{ 
    election: { 
        election_id: 'abcd',
        title: ... },
    voter_auth: {
        authorized_voter: true,
        has_voted: false,
        roles: ['owner']}
 }
```

## Ballot
Ballot requests

### Cast Ballot
Cast a ballot for an election

| | |
| --------- | --------- |
| Method Type | POST |
| URL | Election/:election_id/vote |
| Content Type | application/json |
| Required Permission | none |

| Arguments | Type | Required? | Description |
| --------- | --------- | --------- | --------- |
| ballot | string | required | JSON String containing [ballot object](models.html#ballot) |

**Example**
```
{ ballot: 
    { election_id: 'abcd',
      votes: ...
    }
}
```


**Example Response**
```
{ ballot: 
    { ballot_id: '1234',
      election_id: 'abcd',
      votes: ...
    } 
}
```


## Election Rolls